#!/usr/bin/env node

/**
 * # package
 *
 * shows information about the package at current working directory
 */

// DEPENDENCIES

const { basename, resolve, dirname } = require('path')
var format = require('util').format

// ARGV

var argv = process.argv.slice(2)
if (argv.length > 1 || argv[0] == '--usage' || argv[0] == '--help') {
  console.log('Usage: %s [dirname]', basename(__filename))
  process.exit(1)
}

let packdata = require('@iaigz/tool-package-cwdpackage')

var pkg = packdata(argv[0])

console.log('%s@%s %s', pkg.name, pkg.version, pkg.dir)
console.log('basic info:')
console.log('  name: ' + pkg.name)
console.log('  ver : ' + pkg.version)
console.log('  desc: ' + pkg.description)

console.log()
console.log('entry points:')
console.log('  main: ' + pkg.main)
console.log('  browser: ' + pkg.browser)

function describe (deps) {
  return deps
    ? Object.keys(deps).map((name) => name + ' > ' + deps[name]).join(',\n        ')
    : 'undefined'
}
console.log()
console.log('dependencies (need=normal, bund=bundle, opt=optional)')
pkg.dependencies && console.log('  need:', describe(pkg.dependencies))
pkg.devDependencies && console.log('   dev:', describe(pkg.devDependencies))
pkg.peerDependencies && console.log('  peer:', describe(pkg.peerDependencies))
let bundle = pkg.bundledDependencies || pkg.bundleDependencies
bundle && console.log('  bund:', describe(bundle))
pkg.optionalDependencies && console.log('   opt:', describe(pkg.optionalDependencies))

console.log()
if (pkg.directories) {
  console.log('structure: ' + JSON.stringify(pkg.directories, null, 2))
} else {
  console.log('no directories defined')
}

console.log()
if (pkg.scripts) {
  console.log('available scripts:')
  Object.keys(pkg.scripts).forEach(key => {
    console.log(`  ${key}: ${pkg.scripts[key]}`)
  })
} else {
  console.log('no scripts defined')
}
