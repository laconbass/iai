#!/usr/bin/env node

var iai = require('iai-api')
var Job = require('./Job')

// populate require.cache before using iai.sources
require('./backend')

Job('node', ['-e', "require('./backend').listen(27780)"], {
  watch: iai.sources(require.cache[require.resolve('./backend')])
})
  .start()

const { resolve } = require('path')
var pkg = iai.packdata()
var bin = resolve(pkg.dir, 'node_modules', '.bin')

Job(resolve(bin, 'watchify'), [
  './browser',
  '-o', resolve(bin, 'exorcist') + ' ./www/js/bundle.js.map > ./www/js/bundle.js',
  '-d', '-v'
], { stdio: 'pipe'
})
  .start()
