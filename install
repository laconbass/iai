##
# outputs the directory where iai resides (the "iai root").
# SEE http://stackoverflow.com/a/246128/1894803
##
iai-root () {
	local SOURCE="${BASH_SOURCE[0]}" DIR=""
	while [ -h "$SOURCE" ]; do
		DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
		SOURCE="$(readlink "$SOURCE")"
		[[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE"
	done
	echo "$( cd -P "$( dirname "$SOURCE" )" && pwd )"
}
##
# research if environment is a standard or termux instalation
##
env-mode () {
  if termux-info &>/dev/null; then
    echo "termux"
  else
    echo "standard"
  fi
}

echo "Researching the iai path..."
IAI_PATH="$(iai-root)/script/$(env-mode)"
test -d "$IAI_PATH" || {
  echo "Error: '$IAI_PATH' is not a directory";
  exit 1;
} >&2
echo "iai scripts are located at $IAI_PATH"

RC_FILE=~/.bashrc

RC_LINE="export PATH=\"\$PATH:$IAI_PATH\""

echo "Checking if ${RC_FILE/$HOME/"~"} contains the old installation path..."
grep "$RC_LINE" "$RC_FILE" &>/dev/null && {
  echo "WARN: ${RC_FILE/$HOME/"~"} contains an old-installation path line"
  echo "will remove it now"
  grep -v "$RC_LINE" "$RC_FILE" >temporal-rc-file
  mv temporal-rc-file "$RC_FILE"
  cat <<INFO
  removed the path line from ${RC_FILE/$HOME/"~"}
  to finish unistall, restart the shell
INFO
} >&2

# this is the old "install" way
#printf "\n$RC_LINE\n" >>$RC_FILE

echo "Creating system-wide symbolic links for scripts..."
for origin in $IAI_PATH/*
do
  file="/usr/local/bin/$(basename "$origin")"
  test -L "$file" && echo "symbolic link $file will be replaced"
  echo "> ln -s -i ${origin/$HOME/~} $file" # to automate use -f instead of -i
  sudo ln -s -i $origin $file
done

##
# vim modeline
# /* vim: set expandtab: */
# /* vim: set filetype=sh ts=2 shiftwidth=2: */
