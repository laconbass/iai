assert_function iai || exit

function iai-todo () {
	# provides an interactive api to properly manage the things to be done
	##
	test -n "$1" || { emsg "missing command"; iai-todo.help | utip; exit 1; }

	local cmd="iai-todo.$1"
	is_function "$cmd" || {
	  emsg "command %s does not exist" "$1"
		iai-todo.help | utip
		exit 1
  }
	shift
	$cmd "$@"
}

function iai-todo.help () {
	cat <<HELP
########
iai todo
########

Usage: iai todo {command} [args]

Available commands:
$(while read d t fn; do echo $fn; done < <(declare -F)\
	| grep "iai-todo."\
	| sort\
	|	while read cmd; do printf "  ${cmd##iai-todo.}"; done
)

HELP
	if test -n "$1"
	then
	  local cmd="iai-todo.$1"
		if is_function "$cmd"
		then
			<<<"$(caller)" read l file
			read -d : l <<<"$(grep -n "$cmd" "$file")"
			local n=2 # dont understand why this bug
			while read line; do
				test $(( ++n )) -lt "$l" && continue
				[[ "$line" =~ '##' ]] && break
				echo "${line##*# }"
			done < <(cat "$file")
		else
			emsg "command %s does not exist" "$1"
		fi
	else
    echo 'Use `iai todo help {command}` to obtain help about a command'
    echo 'Use `iai todo help help` to see a broader description'
	fi
}

function iai-todo.find () {
	# this is the help for find
	##
  grep --color=always -d recurse -ni todo ./* | less -R
}

function iai-todo.count () {
	# this is the help for count
	##
  grep -ci "TODO" test/bash/*
}
##
# vim modeline
# /* vim: set filetype=sh ts=2 shiftwidth=2: */
