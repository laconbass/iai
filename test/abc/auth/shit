#!/bin/bash

assert_function iai || exit

function iai-auth.su {
  local user pass
  utip "input the username"
	read user
  utip "input the password"
	read -s pass
  info "checking credentials..."
  su '$user' -c true <<<"$pass"
}

echo "-------------------------------------------------"
TESTUSER=lolo
TESTPASS=insecure

info "> automated iai-login test"
iai login <<<"$TESTUSER"$'\n'"$TESTPASS" && echo "OK" || {
  echo "authorization doesn't succed for $TESTUSER:$TESTPASS"
	info "> iai-login test reading username and password from stdin"
	iai login && echo "OK" || echo "KO"
}

#info "> su test reading credentials"; iai-auth.su && echo "OK" || echo "KO"
info "> su test with $TESTPASS password"
iai-auth.su <<<$"$TESTUSER"$'\n'"$TESTPASS" && echo "OK" || echo "KO"

##
# vim modeline
# /* vim: set filetype=sh ts=2 shiftwidth=2: */
